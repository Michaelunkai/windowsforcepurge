# Run as administrator
$ErrorActionPreference = 'SilentlyContinue'
$serviceName = "MBAMService"
$paths = @(
    "C:\Program Files\Malwarebytes\Anti-Malware\malwarebytes_assistant.exe",
    "C:\Windows\Prefetch\MALWAREBYTES_ASSISTANT.EXE-C3209CFE.pf",
    "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Malwarebytes.lnk",
    "C:\Users\Public\Desktop\Malwarebytes.lnk",
    "C:\Windows\SysWOW64\config\systemprofile\AppData\Local\Malwarebytes",
    "C:\Windows\System32\config\systemprofile\AppData\Local\Malwarebytes",
    "C:\Windows\ServiceProfiles\NetworkService\AppData\Local\Malwarebytes",
    "C:\Users\*\AppData\Local\Malwarebytes",
    "C:\ProgramData\Malwarebytes",
    "C:\Program Files\Malwarebytes"
)

# Stop Malwarebytes processes and service
Get-Process | Where-Object {$_.Name -like "*mbam*" -or $_.Name -like "*malware*"} | Stop-Process -Force
Stop-Service -Name $serviceName -Force
sc.exe delete $serviceName

# Uninstall Malwarebytes using standard uninstaller
$uninstallString = (Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*" | Where-Object {$_.DisplayName -like "*Malwarebytes*"}).UninstallString
if ($uninstallString) {
    Start-Process -Wait -FilePath "cmd.exe" -ArgumentList "/c $uninstallString /verysilent /suppressmsgboxes /norestart"
}

# Remove Malwarebytes registry keys
@(
    "HKLM:\SOFTWARE\Malwarebytes",
    "HKLM:\SOFTWARE\Wow6432Node\Malwarebytes",
    "HKCU:\SOFTWARE\Malwarebytes"
) | ForEach-Object {
    Remove-Item -Path $_ -Recurse -Force
}

# Remove specified files and directories
$paths | ForEach-Object {
    if (Test-Path $_) {
        Remove-Item -Path $_ -Recurse -Force
        Write-Host "Removed: $_"
    }
}

# Clean up remnant files in Temp directories
Get-ChildItem -Path $env:TEMP -Recurse | Where-Object {$_.Name -like "*mbam*" -or $_.Name -like "*malware*"} | Remove-Item -Recurse -Force

Write-Host "Malwarebytes removal complete. Please restart your computer."
