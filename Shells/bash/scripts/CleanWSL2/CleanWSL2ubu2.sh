#!/bin/bash\n\nset -euo pipefail\n\necho \"Starting deep system cleanup for Ubuntu WSL2...\"\n\n# 1. Update & Upgrade System\necho \"Updating system packages...\"\nexport DEBIAN_FRONTEND=noninteractive\nsudo apt update -y && sudo apt upgrade -y || true\n\n# Check if deborphan is available before installing\nif apt-cache search deborphan | grep -q deborphan; then\n    # 2. Install deborphan for orphaned package cleanup\n    echo \"Installing deborphan...\"\nsudo apt install -y deborphan || true\n    DEBORPHAN_AVAILABLE=1\nelse\n    echo \"deborphan not available, skipping orphaned library removal\"\n    DEBORPHAN_AVAILABLE=0\nfi\n\n# 3. Remove unused packages and dependencies\necho \"Removing unused packages and dependencies...\"\nsudo apt autoremove --purge -y\nsudo apt autoclean -y\nsudo apt clean -y\n\n# 4. Purge residual package configurations\necho \"Purging residual package configurations...\"\nexport DEBIAN_FRONTEND=noninteractive\nsudo dpkg --configure -a || true\nsudo dpkg -l | awk '/^rc/ {print $2}' | xargs -r sudo apt purge -y || true\n\n# 5. Clear logs, cache, temp\necho \"Clearing logs, cache, and temporary files...\"\nsudo find /var/log -type f -exec truncate -s 0 {} + 2>/dev/null || true\nsudo find /var/log -name \"*.gz\" -exec rm -f {} + 2>/dev/null || true\nsudo find /var/log -regex \".*\\.[0-9]+\" -exec rm -f {} + 2>/dev/null || true\nsudo rm -rf /var/cache/* 2>/dev/null || true\nsudo rm -rf ~/.cache/* ~/.local/share/Trash/* ~/.cache/thumbnails/* 2>/dev/null || true\nsudo rm -rf /tmp/* /var/tmp/* 2>/dev/null || true\n\n# 6. Remove old kernels (safe in WSL)\necho \"Removing old kernels...\"\nsudo apt remove --purge -y $(dpkg --list | awk '/^ii  linux-image-[0-9]/{print $2}' | grep -v $(uname -r)) 2>/dev/null || true\n\n# 7. Remove orphaned libraries (if deborphan is available)\nif [ $DEBORPHAN_AVAILABLE -eq 1 ]; then\n    echo \"Removing orphaned libraries...\"\n    sudo deborphan | xargs -r sudo apt-get -y remove --purge || true\nfi\n\n# 8. Disable and remove non-essential services\necho \"Disabling unnecessary services...\"\nsudo systemctl disable --now apport.service || true\nsudo systemctl disable --now whoopsie || true\nsudo systemctl disable --now motd-news.timer || true\nsudo systemctl disable --now unattended-upgrades || true\n\n# 9. Remove fonts and language packs\necho \"Removing fonts and language packs...\"\nsudo apt remove --purge -y fonts-* language-pack-* 2>/dev/null || true\n\n# 10. Remove documentation\necho \"Removing manuals, docs, and info pages...\"\nsudo rm -rf /usr/share/man/* /usr/share/doc/* /usr/share/info/* /usr/share/lintian/* /usr/share/linda/* 2>/dev/null || true\n\n# 11. Remove Snap and whoopsie\necho \"Removing Snap and whoopsie...\"\nsudo systemctl stop snapd || true\nsudo apt-get remove --purge -y snapd whoopsie 2>/dev/null || true\n\n# 12. Clear crash reports and journal\necho \"Cleaning orphaned logs and crash reports...\"\nsudo rm -rf /var/crash/* /var/lib/systemd/coredump/* /var/lib/apport/coredump/* ~/.xsession-errors* 2>/dev/null || true\nsudo journalctl --vacuum-time=1d 2>/dev/null || true\n\n# 13. Remove temporary SSH host keys\necho \"Removing SSH host keys...\"\nsudo rm -rf /etc/ssh/ssh_host_* 2>/dev/null || true\n\n# 14. Clean broken symlinks\necho \"Removing broken symlinks...\"\nsudo find / -xdev -xtype l -delete 2>/dev/null || true\n\n# 15. Clean thumbnail cache\necho \"Removing thumbnail cache...\"\nsudo rm -rf ~/.thumbnails ~/.cache/thumbnails 2>/dev/null || true\n\n# 16. Remove unused locales\necho \"Removing unused locales...\"\nsudo locale-gen --purge en_US.UTF-8 2>/dev/null || true\n\n# 17. Auto-delete large unused files over 50M\necho \"Deleting large files (>50M)...\"\nsudo find / -xdev -type f -size +50M ! -path \"/proc/*\" ! -path \"/sys/*\" ! -path \"/dev/*\" -exec rm -f {} + 2>/dev/null || true\n\n# 18. Clear icon cache\necho \"Clearing icon cache...\"\nrm -rf ~/.icons ~/.local/share/icons ~/.cache/icon-cache.kcache 2>/dev/null || true\n\n# 19. Remove old snapshots\necho \"Cleaning old system snapshots...\"\nsudo rm -rf /var/lib/snapshots/* || true\n\n# 20. Zero-fill disk\necho \"Zero-filling disk space...\"\nif [ -w / ]; then\n  sudo dd if=/dev/zero of=/EMPTY bs=1M 2>/dev/null || true\n  sudo rm -f /EMPTY 2>/dev/null || true\nfi\n\n# 21. Optional defragment\nif command -v e4defrag &> /dev/null; then\n    echo \"Defragmenting filesystem...\"\n    sudo e4defrag / 2>/dev/null || true\nfi\n\n# 22. Rebuild APT cache\necho \"Rebuilding package lists...\"\nsudo rm -rf /var/lib/apt/lists/* 2>/dev/null || true\nsudo apt update -y || true\n\n# 23. Disk space check\necho \"Final disk space usage:\"\ndf -h\n\n# 24. Remove leftover dpkg and cache\necho \"Removing leftover dpkg and cache files...\"\nsudo rm -rf /var/lib/dpkg/info/* /var/lib/apt/lists/* /var/lib/polkit-1/* 2>/dev/null || true\nsudo rm -rf /var/log/alternatives.log /usr/lib/x86_64-linux-gnu/dri/* 2>/dev/null || true\nsudo rm -rf /usr/share/python-wheels/* /var/cache/apt/pkgcache.bin /var/cache/apt/srcpkgcache.bin 2>/dev/null || true\n\n# 25. Remove deborphan (if it was installed)\nif [ $DEBORPHAN_AVAILABLE -eq 1 ]; then\n    echo \"Purging deborphan...\"\n    sudo apt purge -y deborphan 2>/dev/null || true\nfi\n\necho \"âœ… Deep WSL2 cleanup completed successfully!\"\n