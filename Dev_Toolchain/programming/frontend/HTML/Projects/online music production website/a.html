<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeatForge Pro Studio - Professional DAW</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow: hidden;
            font-size: 12px;
        }

        .daw-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
        }

        /* Professional Header */
        .header {
            background: linear-gradient(180deg, #1e1e1e 0%, #0f0f0f 100%);
            border-bottom: 1px solid #333;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b35, #f7931e, #ffd23f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .project-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .project-name {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }

        .project-details {
            font-size: 10px;
            color: #888;
        }

        .transport-section {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #1a1a1a;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #333;
        }

        .transport-btn {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 1px solid #333;
            color: #fff;
            padding: 8px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            min-width: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .transport-btn:hover {
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border-color: #555;
        }

        .transport-btn.active {
            background: linear-gradient(145deg, #ff4757, #ff3742);
            border-color: #ff4757;
        }

        .transport-btn.play.active {
            background: linear-gradient(145deg, #2ed573, #20bf6b);
            border-color: #2ed573;
        }

        .tempo-section {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 16px;
        }

        .tempo-input {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 6px 8px;
            border-radius: 4px;
            width: 60px;
            text-align: center;
            font-size: 12px;
        }

        .time-signature {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 6px 8px;
            border-radius: 4px;
            width: 50px;
            text-align: center;
            font-size: 12px;
        }

        .master-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .cpu-meter {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            color: #888;
        }

        .cpu-bar {
            width: 40px;
            height: 4px;
            background: #333;
            border-radius: 2px;
            overflow: hidden;
        }

        .cpu-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ed573, #ffa502, #ff4757);
            width: 35%;
            transition: width 0.5s ease;
        }

        /* Main Layout */
        .main-layout {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Left Panel - Browser & Inspector */
        .left-panel {
            width: 280px;
            background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-tabs {
            display: flex;
            background: #0f0f0f;
            border-bottom: 1px solid #333;
        }

        .panel-tab {
            flex: 1;
            padding: 10px 8px;
            text-align: center;
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 11px;
            border-right: 1px solid #333;
        }

        .panel-tab:last-child {
            border-right: none;
        }

        .panel-tab.active {
            background: #1a1a1a;
            color: #fff;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        /* Browser Panel */
        .browser-section {
            margin-bottom: 20px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #333;
            margin-bottom: 10px;
        }

        .section-title {
            font-size: 12px;
            font-weight: 600;
            color: #fff;
        }

        .section-toggle {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 10px;
        }

        /* Virtual Instruments */
        .instrument-bank {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            margin-bottom: 12px;
        }

        .instrument-slot {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 1px solid #333;
            border-radius: 6px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            position: relative;
        }

        .instrument-slot:hover {
            border-color: #555;
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
        }

        .instrument-slot.active {
            border-color: #ff6b35;
            box-shadow: 0 0 8px rgba(255, 107, 53, 0.3);
        }

        .instrument-icon {
            font-size: 16px;
            display: block;
            margin-bottom: 4px;
        }

        .instrument-name {
            font-size: 10px;
            color: #ccc;
            font-weight: 500;
        }

        /* Sample Library */
        .sample-grid {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .sample-item {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sample-item:hover {
            background: #2a2a2a;
            border-color: #555;
        }

        .sample-waveform {
            width: 30px;
            height: 12px;
            background: #333;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }

        .sample-waveform::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, #4ecdc4 20%, #45b7d1 50%, #4ecdc4 80%, transparent 100%);
            opacity: 0.6;
        }

        .sample-info {
            flex: 1;
        }

        .sample-name {
            font-size: 11px;
            color: #fff;
            margin-bottom: 2px;
        }

        .sample-details {
            font-size: 9px;
            color: #888;
        }

        /* Effects Rack */
        .effects-rack {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .effect-category {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            overflow: hidden;
        }

        .effect-category-header {
            background: #0f0f0f;
            padding: 8px 12px;
            border-bottom: 1px solid #333;
            font-size: 11px;
            font-weight: 600;
            color: #fff;
            cursor: pointer;
        }

        .effect-list {
            padding: 8px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 4px;
        }

        .effect-item {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 1px solid #333;
            border-radius: 4px;
            padding: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-size: 10px;
        }

        .effect-item:hover {
            border-color: #555;
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
        }

        /* Center Panel - Arrangement View */
        .center-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0a0a0a;
            overflow: hidden;
        }

        .arrangement-header {
            background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
            border-bottom: 1px solid #333;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .view-controls {
            display: flex;
            gap: 4px;
        }

        .view-btn {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 1px solid #333;
            color: #fff;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 10px;
        }

        .view-btn.active {
            background: linear-gradient(145deg, #ff6b35, #f7931e);
            border-color: #ff6b35;
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .zoom-slider {
            width: 100px;
            height: 20px;
            background: #1a1a1a;
            border-radius: 10px;
            position: relative;
            cursor: pointer;
        }

        .zoom-handle {
            position: absolute;
            top: 2px;
            left: 30%;
            width: 16px;
            height: 16px;
            background: linear-gradient(145deg, #ff6b35, #f7931e);
            border-radius: 50%;
            cursor: grab;
        }

        .zoom-handle:active {
            cursor: grabbing;
        }

        /* Timeline */
        .timeline-container {
            height: 40px;
            background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
            border-bottom: 1px solid #333;
            position: relative;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .timeline {
            height: 100%;
            min-width: 2000px;
            position: relative;
            background-image: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 99px,
                #333 100px
            );
        }

        .playhead {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #ff4757;
            z-index: 100;
            transition: left 0.1s linear;
        }

        .playhead::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            width: 12px;
            height: 10px;
            background: #ff4757;
            clip-path: polygon(50% 100%, 0% 0%, 100% 0%);
        }

        .time-rulers {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: #0f0f0f;
            border-bottom: 1px solid #333;
        }

        .time-markers {
            display: flex;
            height: 100%;
            position: relative;
        }

        .time-marker {
            flex: 0 0 100px;
            border-left: 1px solid #333;
            padding-left: 4px;
            font-size: 9px;
            color: #888;
            display: flex;
            align-items: center;
        }

        .beat-markers {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 20px;
            background: #1a1a1a;
            background-image: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 24px,
                #333 25px
            );
        }

        /* Track Area */
        .track-area {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
        }

        .track-container {
            display: flex;
            min-height: 100%;
        }

        .track-headers {
            width: 200px;
            background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
            border-right: 1px solid #333;
            flex-shrink: 0;
        }

        .track-content {
            flex: 1;
            position: relative;
            min-width: 2000px;
            background-image: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 99px,
                #333 100px
            );
        }

        .track {
            height: 80px;
            border-bottom: 1px solid #333;
            display: flex;
            position: relative;
        }

        .track-header {
            width: 200px;
            background: linear-gradient(90deg, #1a1a1a 0%, #0f0f0f 100%);
            border-right: 1px solid #333;
            padding: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .track-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .track-name {
            font-size: 11px;
            font-weight: 600;
            color: #fff;
            background: none;
            border: none;
            outline: none;
            cursor: text;
        }

        .track-type {
            font-size: 9px;
            color: #888;
            padding: 2px 4px;
            background: #333;
            border-radius: 2px;
        }

        .track-controls {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .track-btn {
            width: 20px;
            height: 20px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 8px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mute-btn {
            background: #666;
            color: #fff;
        }

        .mute-btn.active {
            background: #ff9500;
            color: #fff;
        }

        .solo-btn {
            background: #666;
            color: #fff;
        }

        .solo-btn.active {
            background: #ffff00;
            color: #000;
        }

        .record-btn {
            background: #666;
            color: #fff;
        }

        .record-btn.active {
            background: #ff0000;
            color: #fff;
            animation: pulse 1s infinite;
        }

        .monitor-btn {
            background: #666;
            color: #fff;
        }

        .monitor-btn.active {
            background: #00ff00;
            color: #000;
        }

        .track-meters {
            display: flex;
            gap: 2px;
            align-items: center;
            margin-left: 8px;
        }

        .level-meter {
            width: 3px;
            height: 40px;
            background: #333;
            border-radius: 1px;
            position: relative;
            overflow: hidden;
        }

        .level-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(0deg, #2ed573 0%, #ffa502 70%, #ff4757 100%);
            transition: height 0.1s ease;
        }

        .track-lane {
            flex: 1;
            position: relative;
            background: rgba(255, 255, 255, 0.02);
        }

        .track-lane:nth-child(even) {
            background: rgba(255, 255, 255, 0.01);
        }

        /* Audio Clips */
        .audio-clip {
            position: absolute;
            height: 60px;
            top: 10px;
            background: linear-gradient(145deg, #4a4a4a, #2a2a2a);
            border: 1px solid #666;
            border-radius: 4px;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .audio-clip:hover {
            border-color: #888;
            background: linear-gradient(145deg, #5a5a5a, #3a3a3a);
        }

        .audio-clip.selected {
            border-color: #ff6b35;
            box-shadow: 0 0 8px rgba(255, 107, 53, 0.5);
        }

        .clip-header {
            padding: 4px 8px;
            background: rgba(0, 0, 0, 0.3);
            font-size: 9px;
            color: #fff;
            border-bottom: 1px solid #555;
        }

        .clip-waveform {
            flex: 1;
            padding: 4px;
            position: relative;
        }

        .waveform-canvas {
            width: 100%;
            height: 100%;
            opacity: 0.8;
        }

        .clip-fade-in, .clip-fade-out {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 10px;
            cursor: ew-resize;
        }

        .clip-fade-in {
            left: 0;
            background: linear-gradient(90deg, rgba(255, 107, 53, 0.5), transparent);
        }

        .clip-fade-out {
            right: 0;
            background: linear-gradient(-90deg, rgba(255, 107, 53, 0.5), transparent);
        }

        /* Right Panel - Mixer & Inspector */
        .right-panel {
            width: 320px;
            background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Mixer */
        .mixer-section {
            flex: 1;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .mixer-container {
            display: flex;
            height: 100%;
            min-width: 100%;
        }

        .mixer-channel {
            width: 60px;
            height: 100%;
            background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            padding: 8px 4px;
        }

        .channel-header {
            text-align: center;
            margin-bottom: 8px;
        }

        .channel-name {
            font-size: 9px;
            color: #fff;
            margin-bottom: 4px;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }

        .channel-type {
            font-size: 8px;
            color: #888;
        }

        /* EQ Section */
        .eq-section {
            height: 120px;
            margin-bottom: 8px;
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .eq-curve {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: #4ecdc4;
            transform: translateY(-50%);
        }

        .eq-knobs {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-bottom: 8px;
        }

        .eq-knob {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .knob {
            width: 24px;
            height: 24px;
            background: linear-gradient(145deg, #3a3a3a, #1a1a1a);
            border: 1px solid #555;
            border-radius: 50%;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .knob::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 1px;
            height: 8px;
            background: #ff6b35;
            border-radius: 1px;
            transform-origin: center 10px;
        }

        .knob:hover {
            border-color: #777;
        }

        .knob-label {
            font-size: 7px;
            color: #888;
            text-align: center;
        }

        /* Sends & Inserts */
        .sends-section {
            margin-bottom: 8px;
        }

        .sends-header {
            font-size: 8px;
            color: #888;
            margin-bottom: 4px;
            text-align: center;
        }

        .send-knobs {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        /* Channel Fader */
        .fader-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 8px;
        }

        .pan-knob {
            margin-bottom: 8px;
        }

        .volume-fader {
            width: 20px;
            height: 200px;
            background: #333;
            border-radius: 10px;
            position: relative;
            cursor: ns-resize;
            margin-bottom: 8px;
        }

        .fader-handle {
            position: absolute;
            left: -2px;
            width: 24px;
            height: 16px;
            background: linear-gradient(145deg, #ff6b35, #f7931e);
            border-radius: 2px;
            cursor: grab;
            transition: all 0.2s ease;
            top: 50%;
            transform: translateY(-50%);
        }

        .fader-handle:active {
            cursor: grabbing;
        }

        .volume-label {
            font-size: 7px;
            color: #888;
            text-align: center;
        }

        .channel-meters {
            display: flex;
            gap: 1px;
            height: 60px;
            margin-bottom: 4px;
        }

        /* Master Section */
        .master-channel {
            width: 80px;
            background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
            border-left: 2px solid #ff6b35;
        }

        /* Inspector Panel */
        .inspector-section {
            height: 300px;
            border-top: 1px solid #333;
            overflow-y: auto;
            padding: 12px;
        }

        .inspector-header {
            font-size: 12px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .property-group {
            margin-bottom: 16px;
        }

        .property-label {
            font-size: 10px;
            color: #888;
            margin-bottom: 4px;
        }

        .property-value {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 6px 8px;
            border-radius: 4px;
            font-size: 11px;
            width: 100%;
        }

        .property-slider {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            position: relative;
            cursor: pointer;
        }

        .slider-handle {
            position: absolute;
            top: 2px;
            width: 16px;
            height: 16px;
            background: linear-gradient(145deg, #ff6b35, #f7931e);
            border-radius: 50%;
            cursor: grab;
            transition: all 0.2s ease;
        }

        /* Piano Roll (Hidden by default) */
        .piano-roll {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #0a0a0a;
            z-index: 200;
            display: none;
        }

        .piano-roll.active {
            display: flex;
            flex-direction: column;
        }

        .piano-roll-header {
            height: 40px;
            background: #1a1a1a;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            padding: 0 16px;
        }

        .piano-roll-content {
            flex: 1;
            display: flex;
        }

        .piano-keys {
            width: 120px;
            background: #1a1a1a;
            border-right: 1px solid #333;
        }

        .piano-grid {
            flex: 1;
            background: #0f0f0f;
            position: relative;
            overflow: auto;
        }

        /* Status Bar */
        .status-bar {
            height: 24px;
            background: #0f0f0f;
            border-top: 1px solid #333;
            display: flex;
            align-items: center;
            padding: 0 16px;
            font-size: 10px;
            color: #888;
            justify-content: space-between;
        }

        .status-left {
            display: flex;
            gap: 16px;
        }

        .status-right {
            display: flex;
            gap: 16px;
        }

        /* Collaboration Features */
        .collaboration-overlay {
            position: fixed;
            top: 60px;
            right: 20px;
            width: 280px;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 16px;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .collab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .collab-title {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }

        .collab-close {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 16px;
        }

        .collaborator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }

        .collaborator:last-child {
            border-bottom: none;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b35, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            color: #fff;
        }

        .collaborator-info {
            flex: 1;
        }

        .collaborator-name {
            font-size: 12px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 2px;
        }

        .collaborator-activity {
            font-size: 10px;
            color: #888;
        }

        .presence-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #2ed573;
            animation: pulse 2s infinite;
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .left-panel {
                width: 240px;
            }
            .right-panel {
                width: 280px;
            }
        }

        @media (max-width: 1200px) {
            .left-panel {
                width: 200px;
            }
            .right-panel {
                width: 240px;
            }
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(255, 107, 53, 0.5); }
            100% { box-shadow: 0 0 20px rgba(255, 107, 53, 0.8); }
        }

        /* Custom Scrollbars */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        ::-webkit-scrollbar-corner {
            background: #1a1a1a;
        }

        /* Loading States */
        .loading {
            opacity: 0.5;
            pointer-events: none;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #333;
            border-top: 2px solid #ff6b35;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="daw-container">
        <!-- Professional Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo">🎵 BeatForge Pro</div>
                <div class="project-info">
                    <div class="project-name">Untitled Project</div>
                    <div class="project-details">44.1kHz • 24-bit • 120 BPM</div>
                </div>
            </div>
            
            <div class="transport-section">
                <button class="transport-btn" onclick="rewind()" title="Rewind">⏪</button>
                <button class="transport-btn play" onclick="togglePlay()" title="Play/Pause">▶️</button>
                <button class="transport-btn" onclick="stop()" title="Stop">⏹️</button>
                <button class="transport-btn" onclick="toggleRecord()" title="Record">⏺️</button>
                <button class="transport-btn" onclick="toggleLoop()" title="Loop">🔄</button>
                <button class="transport-btn" onclick="toggleMetronome()" title="Metronome">🎯</button>
                
                <div class="tempo-section">
                    <input type="number" class="tempo-input" value="120" min="60" max="200" id="tempoInput">
                    <span style="font-size: 10px; color: #888;">BPM</span>
                    <input type="text" class="time-signature" value="4/4" id="timeSigInput">
                </div>
                
                <div id="timeDisplay" style="margin-left: 16px; font-family: monospace; color: #fff;">00:00:00</div>
            </div>
            
            <div class="master-section">
                <div class="cpu-meter">
                    <span>CPU:</span>
                    <div class="cpu-bar">
                        <div class="cpu-fill" id="cpuFill"></div>
                    </div>
                    <span id="cpuValue">35%</span>
                </div>
                <button class="transport-btn" onclick="showCollaboration()" title="Collaboration">👥</button>
                <button class="transport-btn" onclick="exportProject()" title="Export">📤</button>
            </div>
        </header>

        <div class="main-layout">
            <!-- Left Panel - Browser & Inspector -->
            <div class="left-panel">
                <div class="panel-tabs">
                    <button class="panel-tab active" onclick="switchPanel('browser')">Browser</button>
                    <button class="panel-tab" onclick="switchPanel('devices')">Devices</button>
                    <button class="panel-tab" onclick="switchPanel('grooves')">Grooves</button>
                </div>
                
                <div class="panel-content" id="browserPanel">
                    <!-- Virtual Instruments -->
                    <div class="browser-section">
                        <div class="section-header">
                            <span class="section-title">Instruments</span>
                            <button class="section-toggle">−</button>
                        </div>
                        <div class="instrument-bank">
                            <div class="instrument-slot" onclick="selectInstrument('operator')">
                                <span class="instrument-icon">🎹</span>
                                <span class="instrument-name">Operator</span>
                            </div>
                            <div class="instrument-slot" onclick="selectInstrument('analog')">
                                <span class="instrument-icon">🎛️</span>
                                <span class="instrument-name">Analog</span>
                            </div>
                            <div class="instrument-slot" onclick="selectInstrument('drum-kit')">
                                <span class="instrument-icon">🥁</span>
                                <span class="instrument-name">Drum Kit</span>
                            </div>
                            <div class="instrument-slot" onclick="selectInstrument('bass')">
                                <span class="instrument-icon">🎸</span>
                                <span class="instrument-name">Electric Bass</span>
                            </div>
                            <div class="instrument-slot" onclick="selectInstrument('piano')">
                                <span class="instrument-icon">🎹</span>
                                <span class="instrument-name">Grand Piano</span>
                            </div>
                            <div class="instrument-slot" onclick="selectInstrument('strings')">
                                <span class="instrument-icon">🎻</span>
                                <span class="instrument-name">Orchestral</span>
                            </div>
                        </div>
                    </div>

                    <!-- Sample Library -->
                    <div class="browser-section">
                        <div class="section-header">
                            <span class="section-title">Samples</span>
                            <button class="section-toggle">−</button>
                        </div>
                        <div class="sample-grid" id="sampleGrid">
                            <!-- Samples will be populated here -->
                        </div>
                    </div>

                    <!-- Effects -->
                    <div class="browser-section">
                        <div class="section-header">
                            <span class="section-title">Audio Effects</span>
                            <button class="section-toggle">−</button>
                        </div>
                        <div class="effects-rack">
                            <div class="effect-category">
                                <div class="effect-category-header" onclick="toggleEffectCategory('dynamics')">Dynamics</div>
                                <div class="effect-list">
                                    <div class="effect-item" onclick="addEffect('compressor')">Compressor</div>
                                    <div class="effect-item" onclick="addEffect('limiter')">Limiter</div>
                                    <div class="effect-item" onclick="addEffect('gate')">Gate</div>
                                    <div class="effect-item" onclick="addEffect('multiband')">Multiband</div>
                                </div>
                            </div>
                            <div class="effect-category">
                                <div class="effect-category-header" onclick="toggleEffectCategory('eq')">EQ & Filters</div>
                                <div class="effect-list">
                                    <div class="effect-item" onclick="addEffect('eq8')">EQ Eight</div>
                                    <div class="effect-item" onclick="addEffect('auto-filter')">Auto Filter</div>
                                    <div class="effect-item" onclick="addEffect('high-cut')">High Cut</div>
                                    <div class="effect-item" onclick="addEffect('low-cut')">Low Cut</div>
                                </div>
                            </div>
                            <div class="effect-category">
                                <div class="effect-category-header" onclick="toggleEffectCategory('modulation')">Modulation</div>
                                <div class="effect-list">
                                    <div class="effect-item" onclick="addEffect('chorus')">Chorus</div>
                                    <div class="effect-item" onclick="addEffect('flanger')">Flanger</div>
                                    <div class="effect-item" onclick="addEffect('phaser')">Phaser</div>
                                    <div class="effect-item" onclick="addEffect('tremolo')">Tremolo</div>
                                </div>
                            </div>
                            <div class="effect-category">
                                <div class="effect-category-header" onclick="toggleEffectCategory('delay')">Delay & Reverb</div>
                                <div class="effect-list">
                                    <div class="effect-item" onclick="addEffect('delay')">Delay</div>
                                    <div class="effect-item" onclick="addEffect('echo')">Echo</div>
                                    <div class="effect-item" onclick="addEffect('reverb')">Reverb</div>
                                    <div class="effect-item" onclick="addEffect('space')">Convolution</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Panel - Arrangement View -->
            <div class="center-panel">
                <div class="arrangement-header">
                    <div class="view-controls">
                        <button class="view-btn active" onclick="switchView('arrangement')">Arrangement</button>
                        <button class="view-btn" onclick="switchView('session')">Session</button>
                        <button class="view-btn" onclick="switchView('piano-roll')" id="pianoRollBtn">Piano Roll</button>
                    </div>
                    
                    <div class="zoom-controls">
                        <span style="font-size: 10px; color: #888; margin-right: 8px;">Zoom:</span>
                        <div class="zoom-slider" onclick="adjustZoom(event)">
                            <div class="zoom-handle" id="zoomHandle"></div>
                        </div>
                        <button class="view-btn" onclick="zoomToFit()">Fit</button>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="timeline-container">
                    <div class="timeline" id="timeline">
                        <div class="playhead" id="playhead"></div>
                        <div class="time-rulers">
                            <div class="time-markers" id="timeMarkers">
                                <!-- Time markers will be generated here -->
                            </div>
                        </div>
                        <div class="beat-markers"></div>
                    </div>
                </div>

                <!-- Track Area -->
                <div class="track-area" id="trackArea">
                    <div class="track-container">
                        <div class="track-headers" id="trackHeaders">
                            <!-- Track headers will be generated here -->
                        </div>
                        <div class="track-content" id="trackContent">
                            <!-- Track content will be generated here -->
                        </div>
                    </div>
                </div>

                <!-- Piano Roll (Hidden) -->
                <div class="piano-roll" id="pianoRoll">
                    <div class="piano-roll-header">
                        <button class="view-btn" onclick="closePianoRoll()">← Back to Arrangement</button>
                        <span style="margin-left: 16px; color: #fff;">Piano Roll - Track 3 (Piano)</span>
                    </div>
                    <div class="piano-roll-content">
                        <div class="piano-keys" id="pianoKeys"></div>
                        <div class="piano-grid" id="pianoGrid"></div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Mixer -->
            <div class="right-panel">
                <div class="mixer-section">
                    <div class="mixer-container" id="mixerContainer">
                        <!-- Mixer channels will be generated here -->
                    </div>
                </div>

                <!-- Inspector -->
                <div class="inspector-section">
                    <div class="inspector-header">
                        <span>🔍</span>
                        <span>Clip Inspector</span>
                    </div>
                    <div class="property-group">
                        <div class="property-label">Name</div>
                        <input type="text" class="property-value" value="Audio Clip 1">
                    </div>
                    <div class="property-group">
                        <div class="property-label">Start Time</div>
                        <input type="text" class="property-value" value="1.1.1">
                    </div>
                    <div class="property-group">
                        <div class="property-label">Length</div>
                        <input type="text" class="property-value" value="4.0.0">
                    </div>
                    <div class="property-group">
                        <div class="property-label">Gain</div>
                        <div class="property-slider">
                            <div class="slider-handle" style="left: 70%;"></div>
                        </div>
                    </div>
                    <div class="property-group">
                        <div class="property-label">Transpose</div>
                        <div class="property-slider">
                            <div class="slider-handle" style="left: 50%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-left">
                <span>Sample Rate: 44.1 kHz</span>
                <span>Buffer: 256 samples</span>
                <span>Latency: 5.8ms</span>
            </div>
            <div class="status-right">
                <span>RAM: 2.1GB</span>
                <span>Disk: 1.2TB free</span>
                <span>Connected: 3 users</span>
            </div>
        </div>

        <!-- Collaboration Overlay -->
        <div class="collaboration-overlay" id="collaborationOverlay" style="display: none;">
            <div class="collab-header">
                <span class="collab-title">Live Collaboration</span>
                <button class="collab-close" onclick="hideCollaboration()">×</button>
            </div>
            <div id="collaboratorList">
                <!-- Collaborators will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Professional DAW State Management
        class DAWState {
            constructor() {
                this.audioContext = null;
                this.masterGain = null;
                this.tracks = new Map();
                this.clips = new Map();
                this.effects = new Map();
                this.instruments = new Map();
                this.isPlaying = false;
                this.isRecording = false;
                this.currentTime = 0;
                this.tempo = 120;
                this.timeSignature = [4, 4];
                this.sampleRate = 44100;
                this.bufferSize = 256;
                this.zoomLevel = 1.0;
                this.selectedClips = new Set();
                this.collaborators = new Map();
                this.projectData = {
                    name: 'Untitled Project',
                    created: new Date(),
                    modified: new Date()
                };
            }

            async initialize() {
                try {
                    // Initialize Web Audio API with professional settings
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)({
                        sampleRate: this.sampleRate,
                        latencyHint: 'playback'
                    });

                    // Create master gain node
                    this.masterGain = this.audioContext.createGain();
                    this.masterGain.connect(this.audioContext.destination);

                    // Initialize professional components
                    await this.initializeInstruments();
                    await this.initializeEffects();
                    
                } catch (audioError) {
                    console.warn('Web Audio API not available, running in demo mode:', audioError);
                    // Create mock audio context for demo purposes
                    this.audioContext = {
                        createGain: () => ({ gain: { value: 1 }, connect: () => {}, disconnect: () => {} }),
                        createOscillator: () => ({ 
                            frequency: { value: 440, setValueAtTime: () => {}, exponentialRampToValueAtTime: () => {} },
                            type: 'sine',
                            connect: () => {},
                            start: () => {},
                            stop: () => {}
                        }),
                        destination: {},
                        currentTime: 0
                    };
                    this.masterGain = this.audioContext.createGain();
                }

                try {
                    this.initializeTracks();
                    this.initializeMixer();
                    this.startVisualization();
                    this.initializeCollaboration();

                    console.log('Professional DAW initialized successfully');
                } catch (error) {
                    console.error('Error in DAW initialization:', error);
                    throw error;
                }
            }

            async initializeInstruments() {
                const instruments = {
                    'operator': new SynthInstrument('fm'),
                    'analog': new SynthInstrument('analog'),
                    'drum-kit': new DrumInstrument(),
                    'bass': new BassInstrument(),
                    'piano': new PianoInstrument(),
                    'strings': new StringInstrument()
                };

                for (const [name, instrument] of Object.entries(instruments)) {
                    await instrument.initialize(this.audioContext);
                    this.instruments.set(name, instrument);
                }
            }

            async initializeEffects() {
                const effectTypes = [
                    'compressor', 'limiter', 'gate', 'multiband',
                    'eq8', 'auto-filter', 'high-cut', 'low-cut',
                    'chorus', 'flanger', 'phaser', 'tremolo',
                    'delay', 'echo', 'reverb', 'space'
                ];

                for (const type of effectTypes) {
                    this.effects.set(type, new AudioEffect(type, this.audioContext));
                }
            }

            initializeTracks() {
                const trackConfigs = [
                    { name: 'Kick', type: 'audio', color: '#ff4757', instrument: 'drum-kit' },
                    { name: 'Snare', type: 'audio', color: '#ff6b35', instrument: 'drum-kit' },
                    { name: 'Hi-Hat', type: 'audio', color: '#ffa502', instrument: 'drum-kit' },
                    { name: 'Bass', type: 'instrument', color: '#2ed573', instrument: 'bass' },
                    { name: 'Piano', type: 'instrument', color: '#4ecdc4', instrument: 'piano' },
                    { name: 'Strings', type: 'instrument', color: '#45b7d1', instrument: 'strings' },
                    { name: 'Lead', type: 'instrument', color: '#a55eea', instrument: 'analog' },
                    { name: 'Vocal', type: 'audio', color: '#fd79a8', instrument: null }
                ];

                trackConfigs.forEach((config, index) => {
                    const track = new Track(index, config, this.audioContext, this.masterGain);
                    this.tracks.set(index, track);
                });

                this.renderTracks();
            }

            initializeMixer() {
                const mixerContainer = document.getElementById('mixerContainer');
                mixerContainer.innerHTML = '';

                // Create mixer channels for each track
                this.tracks.forEach((track, index) => {
                    const channel = this.createMixerChannel(track, index);
                    mixerContainer.appendChild(channel);
                });

                // Add master channel
                const masterChannel = this.createMasterChannel();
                mixerContainer.appendChild(masterChannel);
            }
        }

        // Professional Instrument Classes
        class SynthInstrument {
            constructor(type) {
                this.type = type;
                this.oscillators = [];
                this.gainNode = null;
                this.filterNode = null;
                this.envelope = { attack: 0.1, decay: 0.2, sustain: 0.3, release: 0.5 };
            }

            async initialize(audioContext) {
                try {
                    this.audioContext = audioContext;
                    this.gainNode = audioContext.createGain();
                    this.filterNode = audioContext.createBiquadFilter();
                    
                    this.filterNode.connect(this.gainNode);
                    this.gainNode.connect(audioContext.destination);
                    
                    this.filterNode.type = 'lowpass';
                    this.filterNode.frequency.value = 2000;
                    this.filterNode.Q.value = 1;
                } catch (error) {
                    console.warn('Could not initialize synth instrument:', error);
                }
            }

            play(note, velocity = 127) {
                try {
                    const frequency = this.noteToFrequency(note);
                    const oscillator = this.audioContext.createOscillator();
                    const envelope = this.audioContext.createGain();

                    oscillator.connect(envelope);
                    envelope.connect(this.filterNode);

                    // Configure oscillator based on synth type
                    switch(this.type) {
                        case 'fm':
                            oscillator.type = 'sine';
                            // Add FM modulation
                            const modulator = this.audioContext.createOscillator();
                            const modGain = this.audioContext.createGain();
                            modulator.frequency.value = frequency * 2;
                            modGain.gain.value = 100;
                            modulator.connect(modGain);
                            modGain.connect(oscillator.frequency);
                            modulator.start();
                            break;
                        case 'analog':
                            oscillator.type = 'sawtooth';
                            break;
                    }

                    oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                    
                    // ADSR envelope
                    const now = this.audioContext.currentTime;
                    const velocityNormalized = velocity / 127;
                    
                    envelope.gain.setValueAtTime(0, now);
                    envelope.gain.linearRampToValueAtTime(velocityNormalized, now + this.envelope.attack);
                    envelope.gain.linearRampToValueAtTime(this.envelope.sustain * velocityNormalized, now + this.envelope.attack + this.envelope.decay);
                    
                    oscillator.start(now);
                    
                    return { oscillator, envelope };
                } catch (error) {
                    console.warn('Could not play synth note:', error);
                    return null;
                }
            }

            noteToFrequency(note) {
                // Convert MIDI note to frequency
                return 440 * Math.pow(2, (note - 69) / 12);
            }
        }

        class DrumInstrument {
            constructor() {
                this.samples = new Map();
            }

            async initialize(audioContext) {
                try {
                    this.audioContext = audioContext;
                    // In a real implementation, you'd load actual drum samples
                    this.samples.set('kick', this.createKickDrum());
                    this.samples.set('snare', this.createSnareDrum());
                    this.samples.set('hihat', this.createHiHat());
                } catch (error) {
                    console.warn('Could not initialize drum instrument:', error);
                }
            }

            createKickDrum() {
                return () => {
                    try {
                        const oscillator = this.audioContext.createOscillator();
                        const gain = this.audioContext.createGain();
                        
                        oscillator.connect(gain);
                        gain.connect(this.audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(60, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                        
                        gain.gain.setValueAtTime(1, this.audioContext.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                        
                        oscillator.start();
                        oscillator.stop(this.audioContext.currentTime + 0.5);
                        
                        return { oscillator, gain };
                    } catch (error) {
                        console.warn('Could not create kick drum:', error);
                        return null;
                    }
                };
            }

            createSnareDrum() {
                return () => {
                    try {
                        const oscillator = this.audioContext.createOscillator();
                        const noise = this.createNoise();
                        const gain = this.audioContext.createGain();
                        const filter = this.audioContext.createBiquadFilter();
                        
                        oscillator.connect(gain);
                        noise.connect(filter);
                        filter.connect(gain);
                        gain.connect(this.audioContext.destination);
                        
                        oscillator.frequency.value = 200;
                        filter.type = 'highpass';
                        filter.frequency.value = 1000;
                        
                        gain.gain.setValueAtTime(1, this.audioContext.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.2);
                        
                        oscillator.start();
                        noise.start();
                        oscillator.stop(this.audioContext.currentTime + 0.2);
                        noise.stop(this.audioContext.currentTime + 0.2);
                        
                        return { oscillator, noise, gain };
                    } catch (error) {
                        console.warn('Could not create snare drum:', error);
                        return null;
                    }
                };
            }

            createHiHat() {
                return () => {
                    try {
                        const noise = this.createNoise();
                        const gain = this.audioContext.createGain();
                        const filter = this.audioContext.createBiquadFilter();
                        
                        noise.connect(filter);
                        filter.connect(gain);
                        gain.connect(this.audioContext.destination);
                        
                        filter.type = 'highpass';
                        filter.frequency.value = 8000;
                        
                        gain.gain.setValueAtTime(0.5, this.audioContext.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.1);
                        
                        noise.start();
                        noise.stop(this.audioContext.currentTime + 0.1);
                        
                        return { noise, gain };
                    } catch (error) {
                        console.warn('Could not create hi-hat:', error);
                        return null;
                    }
                };
            }

            createNoise() {
                try {
                    const bufferSize = this.audioContext.sampleRate;
                    const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
                    const output = buffer.getChannelData(0);
                    
                    for (let i = 0; i < bufferSize; i++) {
                        output[i] = Math.random() * 2 - 1;
                    }
                    
                    const noise = this.audioContext.createBufferSource();
                    noise.buffer = buffer;
                    
                    return noise;
                } catch (error) {
                    console.warn('Could not create noise:', error);
                    return null;
                }
            }

            play(drum, velocity = 127) {
                try {
                    if (this.samples.has(drum)) {
                        return this.samples.get(drum)();
                    }
                } catch (error) {
                    console.warn('Could not play drum:', error);
                }
            }
        }

        class BassInstrument extends SynthInstrument {
            constructor() {
                super('bass');
            }

            async initialize(audioContext) {
                await super.initialize(audioContext);
                if (this.filterNode) {
                    this.filterNode.frequency.value = 800;
                }
                this.envelope.attack = 0.01;
                this.envelope.decay = 0.1;
                this.envelope.sustain = 0.8;
                this.envelope.release = 0.3;
            }

            play(note, velocity = 127) {
                const result = super.play(note, velocity);
                if (result && result.oscillator) {
                    result.oscillator.type = 'square';
                }
                return result;
            }
        }

        class PianoInstrument extends SynthInstrument {
            constructor() {
                super('piano');
            }

            async initialize(audioContext) {
                await super.initialize(audioContext);
                this.envelope.attack = 0.01;
                this.envelope.decay = 0.3;
                this.envelope.sustain = 0.1;
                this.envelope.release = 1.0;
            }

            play(note, velocity = 127) {
                try {
                    // Create multiple oscillators for richer piano sound
                    const fundamental = super.play(note, velocity);
                    const harmonic1 = super.play(note + 12, velocity * 0.3);
                    const harmonic2 = super.play(note + 19, velocity * 0.1);
                    
                    if (fundamental) fundamental.oscillator.type = 'triangle';
                    if (harmonic1) harmonic1.oscillator.type = 'sine';
                    if (harmonic2) harmonic2.oscillator.type = 'sine';
                    
                    return { fundamental, harmonic1, harmonic2 };
                } catch (error) {
                    console.warn('Could not play piano note:', error);
                    return null;
                }
            }
        }

        class StringInstrument extends SynthInstrument {
            constructor() {
                super('strings');
            }

            async initialize(audioContext) {
                await super.initialize(audioContext);
                this.envelope.attack = 0.5;
                this.envelope.decay = 0.3;
                this.envelope.sustain = 0.7;
                this.envelope.release = 1.5;
            }

            play(note, velocity = 127) {
                try {
                    const result = super.play(note, velocity);
                    if (result && result.oscillator) {
                        result.oscillator.type = 'sawtooth';
                        
                        // Add vibrato
                        const vibrato = this.audioContext.createOscillator();
                        const vibratoGain = this.audioContext.createGain();
                        vibrato.frequency.value = 5;
                        vibratoGain.gain.value = 10;
                        vibrato.connect(vibratoGain);
                        vibratoGain.connect(result.oscillator.frequency);
                        vibrato.start();
                        
                        return { ...result, vibrato };
                    }
                    return result;
                } catch (error) {
                    console.warn('Could not play string note:', error);
                    return null;
                }
            }
        }

        // Professional Audio Effect Class
        class AudioEffect {
            constructor(type, audioContext) {
                this.type = type;
                this.audioContext = audioContext;
                this.inputNode = null;
                this.outputNode = null;
                this.parameters = new Map();
                this.initialize();
            }

            initialize() {
                try {
                    switch(this.type) {
                        case 'compressor':
                            this.createCompressor();
                            break;
                        case 'eq8':
                            this.createEQ8();
                            break;
                        case 'reverb':
                            this.createReverb();
                            break;
                        case 'delay':
                            this.createDelay();
                            break;
                        // Add more effects...
                        default:
                            this.createBasicEffect();
                            break;
                    }
                } catch (error) {
                    console.warn(`Could not initialize ${this.type} effect:`, error);
                    this.createBasicEffect();
                }
            }

            createBasicEffect() {
                // Fallback basic effect
                this.inputNode = this.audioContext.createGain();
                this.outputNode = this.inputNode;
            }

            createCompressor() {
                const compressor = this.audioContext.createDynamicsCompressor();
                compressor.threshold.value = -24;
                compressor.knee.value = 30;
                compressor.ratio.value = 12;
                compressor.attack.value = 0.003;
                compressor.release.value = 0.25;
                
                this.inputNode = compressor;
                this.outputNode = compressor;
                
                this.parameters.set('threshold', compressor.threshold);
                this.parameters.set('knee', compressor.knee);
                this.parameters.set('ratio', compressor.ratio);
                this.parameters.set('attack', compressor.attack);
                this.parameters.set('release', compressor.release);
            }

            createEQ8() {
                const filters = [];
                const frequencies = [60, 170, 350, 1000, 3500, 6000, 12000, 14000];
                
                // Create 8-band EQ
                frequencies.forEach((freq, index) => {
                    const filter = this.audioContext.createBiquadFilter();
                    filter.frequency.value = freq;
                    filter.Q.value = 1;
                    filter.type = index === 0 ? 'highpass' : 
                                  index === frequencies.length - 1 ? 'lowpass' : 'peaking';
                    filters.push(filter);
                    
                    if (index > 0) {
                        filters[index - 1].connect(filter);
                    }
                });
                
                this.inputNode = filters[0];
                this.outputNode = filters[filters.length - 1];
                this.filters = filters;
                
                // Add parameters for each band
                filters.forEach((filter, index) => {
                    this.parameters.set(`band${index + 1}_freq`, filter.frequency);
                    this.parameters.set(`band${index + 1}_gain`, filter.gain);
                    this.parameters.set(`band${index + 1}_q`, filter.Q);
                });
            }

            createReverb() {
                const convolver = this.audioContext.createConvolver();
                const wetGain = this.audioContext.createGain();
                const dryGain = this.audioContext.createGain();
                const merger = this.audioContext.createChannelMerger(2);
                
                // Create impulse response for reverb
                this.createImpulseResponse(convolver);
                
                // Routing
                const splitter = this.audioContext.createChannelSplitter(2);
                splitter.connect(dryGain);
                splitter.connect(convolver);
                convolver.connect(wetGain);
                dryGain.connect(merger, 0, 0);
                wetGain.connect(merger, 0, 1);
                
                this.inputNode = splitter;
                this.outputNode = merger;
                
                this.parameters.set('wetLevel', wetGain.gain);
                this.parameters.set('dryLevel', dryGain.gain);
            }

            createDelay() {
                const delay = this.audioContext.createDelay(1);
                const feedback = this.audioContext.createGain();
                const wetGain = this.audioContext.createGain();
                const dryGain = this.audioContext.createGain();
                const output = this.audioContext.createGain();
                
                // Routing
                const input = this.audioContext.createGain();
                input.connect(delay);
                input.connect(dryGain);
                delay.connect(feedback);
                delay.connect(wetGain);
                feedback.connect(delay);
                wetGain.connect(output);
                dryGain.connect(output);
                
                // Default values
                delay.delayTime.value = 0.25;
                feedback.gain.value = 0.3;
                wetGain.gain.value = 0.3;
                dryGain.gain.value = 0.7;
                
                this.inputNode = input;
                this.outputNode = output;
                
                this.parameters.set('delayTime', delay.delayTime);
                this.parameters.set('feedback', feedback.gain);
                this.parameters.set('wetLevel', wetGain.gain);
                this.parameters.set('dryLevel', dryGain.gain);
            }

            createImpulseResponse(convolver) {
                try {
                    const length = this.audioContext.sampleRate * 2;
                    const impulse = this.audioContext.createBuffer(2, length, this.audioContext.sampleRate);
                    
                    for (let channel = 0; channel < 2; channel++) {
                        const channelData = impulse.getChannelData(channel);
                        for (let i = 0; i < length; i++) {
                            const n = length - i;
                            channelData[i] = (Math.random() * 2 - 1) * Math.pow(n / length, 2);
                        }
                    }
                    
                    convolver.buffer = impulse;
                } catch (error) {
                    console.warn('Could not create impulse response:', error);
                }
            }
        }

        // Professional Track Class
        class Track {
            constructor(id, config, audioContext, destination) {
                this.id = id;
                this.name = config.name;
                this.type = config.type;
                this.color = config.color;
                this.instrument = config.instrument;
                this.audioContext = audioContext;
                
                // Audio routing
                this.inputNode = null;
                this.outputNode = null;
                this.panNode = null;
                this.effectsChain = [];
                
                // Track state
                this.muted = false;
                this.solo = false;
                this.recording = false;
                this.monitoring = false;
                this.volume = 0.75;
                this.pan = 0;
                
                // Audio clips
                this.clips = [];
                
                // Setup audio routing
                this.setupAudioRouting(destination);
            }

            setupAudioRouting(destination) {
                try {
                    this.inputNode = this.audioContext.createGain();
                    this.outputNode = this.audioContext.createGain();
                    this.panNode = this.audioContext.createStereoPanner();
                    
                    this.inputNode.connect(this.panNode);
                    this.panNode.connect(this.outputNode);
                    this.outputNode.connect(destination);
                    
                    this.outputNode.gain.value = this.volume;
                    this.panNode.pan.value = this.pan;
                } catch (error) {
                    console.warn('Could not setup audio routing for track:', error);
                    // Create fallback nodes
                    this.inputNode = { connect: () => {}, disconnect: () => {} };
                    this.outputNode = { gain: { value: this.volume }, connect: () => {}, disconnect: () => {} };
                    this.panNode = { pan: { value: this.pan }, connect: () => {}, disconnect: () => {} };
                }
            }

            addEffect(effect) {
                try {
                    // Insert effect in the chain
                    if (this.effectsChain.length === 0) {
                        this.inputNode.disconnect();
                        this.inputNode.connect(effect.inputNode);
                        effect.outputNode.connect(this.panNode);
                    } else {
                        const lastEffect = this.effectsChain[this.effectsChain.length - 1];
                        lastEffect.outputNode.disconnect();
                        lastEffect.outputNode.connect(effect.inputNode);
                        effect.outputNode.connect(this.panNode);
                    }
                    
                    this.effectsChain.push(effect);
                } catch (error) {
                    console.warn('Could not add effect to track:', error);
                }
            }

            removeEffect(effectIndex) {
                try {
                    if (effectIndex >= 0 && effectIndex < this.effectsChain.length) {
                        const effect = this.effectsChain[effectIndex];
                        
                        // Reconnect around the removed effect
                        if (effectIndex === 0) {
                            this.inputNode.disconnect();
                            if (this.effectsChain.length > 1) {
                                this.inputNode.connect(this.effectsChain[1].inputNode);
                            } else {
                                this.inputNode.connect(this.panNode);
                            }
                        } else {
                            this.effectsChain[effectIndex - 1].outputNode.disconnect();
                            if (effectIndex === this.effectsChain.length - 1) {
                                this.effectsChain[effectIndex - 1].outputNode.connect(this.panNode);
                            } else {
                                this.effectsChain[effectIndex - 1].outputNode.connect(this.effectsChain[effectIndex + 1].inputNode);
                            }
                        }
                        
                        this.effectsChain.splice(effectIndex, 1);
                    }
                } catch (error) {
                    console.warn('Could not remove effect from track:', error);
                }
            }

            setVolume(value) {
                this.volume = Math.max(0, Math.min(1, value));
                if (this.outputNode && this.outputNode.gain) {
                    this.outputNode.gain.value = this.muted ? 0 : this.volume;
                }
            }

            setPan(value) {
                this.pan = Math.max(-1, Math.min(1, value));
                if (this.panNode && this.panNode.pan) {
                    this.panNode.pan.value = this.pan;
                }
            }

            setMute(muted) {
                this.muted = muted;
                if (this.outputNode && this.outputNode.gain) {
                    this.outputNode.gain.value = muted ? 0 : this.volume;
                }
            }

            setSolo(solo) {
                this.solo = solo;
                // Solo logic would be handled at the DAW level
            }

            addClip(clip) {
                this.clips.push(clip);
                this.clips.sort((a, b) => a.startTime - b.startTime);
            }

            removeClip(clipId) {
                this.clips = this.clips.filter(clip => clip.id !== clipId);
            }
        }

        // Global DAW instance
        let daw;

        // Initialize the professional DAW
        async function initializeDAW() {
            try {
                daw = new DAWState();
                await daw.initialize();
                
                // Generate sample library
                generateSampleLibrary();
                
                // Generate time markers
                generateTimeMarkers();
                
                // Create demo clips
                createDemoClips();
                
                console.log('Professional DAW ready for music production!');
                return daw;
            } catch (error) {
                console.error('Failed to initialize DAW:', error);
                // Show user-friendly error message
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background: rgba(255, 0, 0, 0.1); border: 1px solid #ff4757;
                    padding: 20px; border-radius: 8px; color: #fff; z-index: 9999;
                    font-family: monospace; text-align: center;
                `;
                errorDiv.innerHTML = `
                    <h3>🚫 DAW Initialization Failed</h3>
                    <p>Could not initialize Web Audio API</p>
                    <p style="font-size: 12px; margin-top: 10px;">
                        This may be due to browser restrictions.<br>
                        Try clicking anywhere on the page first, then refresh.
                    </p>
                    <button onclick="this.parentElement.remove(); initializeDAW();" 
                            style="margin-top: 10px; padding: 8px 16px; background: #ff4757; 
                                   border: none; border-radius: 4px; color: white; cursor: pointer;">
                        Retry
                    </button>
                `;
                document.body.appendChild(errorDiv);
            }
        }

        // UI Event Handlers
        function switchPanel(panel) {
            document.querySelectorAll('.panel-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            // Switch panel content logic here
        }

        function switchView(view) {
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (view === 'piano-roll') {
                document.getElementById('pianoRoll').classList.add('active');
                initializePianoRoll();
            } else {
                document.getElementById('pianoRoll').classList.remove('active');
            }
        }

        function selectInstrument(instrumentName) {
            document.querySelectorAll('.instrument-slot').forEach(slot => slot.classList.remove('active'));
            event.target.classList.add('active');
            
            // Play instrument preview
            if (daw && daw.instruments && daw.instruments.has(instrumentName)) {
                try {
                    const instrument = daw.instruments.get(instrumentName);
                    if (instrumentName === 'drum-kit') {
                        instrument.play('kick');
                    } else {
                        instrument.play(60, 100); // Middle C
                    }
                } catch (error) {
                    console.warn('Could not play instrument preview:', error);
                }
            }
        }

        function addEffect(effectName) {
            console.log(`Adding ${effectName} effect`);
            // Add visual feedback
            if (event && event.target) {
                event.target.style.background = 'linear-gradient(145deg, #4ecdc4, #45b7d1)';
                setTimeout(() => {
                    event.target.style.background = '';
                }, 200);
            }
        }

        // Transport Controls
        function togglePlay() {
            if (!daw) {
                console.warn('DAW not initialized yet');
                return;
            }
            
            try {
                daw.isPlaying = !daw.isPlaying;
                const playBtn = document.querySelector('.transport-btn.play');
                
                if (daw.isPlaying) {
                    playBtn.textContent = '⏸️';
                    playBtn.classList.add('active');
                    startPlayback();
                } else {
                    playBtn.textContent = '▶️';
                    playBtn.classList.remove('active');
                    stopPlayback();
                }
            } catch (error) {
                console.error('Error in togglePlay:', error);
            }
        }

        function stop() {
            if (!daw) return;
            
            try {
                daw.isPlaying = false;
                daw.currentTime = 0;
                const playBtn = document.querySelector('.transport-btn.play');
                playBtn.textContent = '▶️';
                playBtn.classList.remove('active');
                updateTimeDisplay();
                updatePlayhead();
            } catch (error) {
                console.error('Error in stop:', error);
            }
        }

        function rewind() {
            if (!daw) return;
            
            try {
                daw.currentTime = Math.max(0, daw.currentTime - 5);
                updateTimeDisplay();
                updatePlayhead();
            } catch (error) {
                console.error('Error in rewind:', error);
            }
        }

        function toggleRecord() {
            if (!daw) {
                console.warn('DAW not initialized yet');
                return;
            }
            
            try {
                daw.isRecording = !daw.isRecording;
                const recordBtn = document.querySelector('.transport-btn[onclick="toggleRecord()"]');
                
                if (daw.isRecording) {
                    recordBtn.classList.add('active');
                    startRecording();
                } else {
                    recordBtn.classList.remove('active');
                    stopRecording();
                }
            } catch (error) {
                console.error('Error in toggleRecord:', error);
            }
        }

        function toggleLoop() {
            const loopBtn = event.target;
            loopBtn.classList.toggle('active');
            console.log('Loop mode:', loopBtn.classList.contains('active') ? 'ON' : 'OFF');
        }

        function toggleMetronome() {
            const metroBtn = event.target;
            metroBtn.classList.toggle('active');
            console.log('Metronome:', metroBtn.classList.contains('active') ? 'ON' : 'OFF');
        }

        function startPlayback() {
            const playInterval = setInterval(() => {
                if (!daw.isPlaying) {
                    clearInterval(playInterval);
                    return;
                }
                
                daw.currentTime += 0.1;
                updateTimeDisplay();
                updatePlayhead();
                updateMeters();
                
                // Trigger scheduled clips and MIDI events
                processPlayback();
            }, 100);
        }

        function stopPlayback() {
            // Stop all playing notes and sounds
        }

        function startRecording() {
            console.log('Recording started...');
            // Implement recording logic
        }

        function stopRecording() {
            console.log('Recording stopped');
            // Save recorded audio
        }

        function processPlayback() {
            // Process all tracks and clips at current time
            daw.tracks.forEach(track => {
                track.clips.forEach(clip => {
                    if (clip.isPlayingAt(daw.currentTime)) {
                        // Trigger clip playback
                    }
                });
            });
        }

        function updateTimeDisplay() {
            if (!daw) return;
            
            const totalSeconds = daw.currentTime;
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = Math.floor(totalSeconds % 60);
            const frames = Math.floor((totalSeconds % 1) * 30);
            
            document.getElementById('timeDisplay').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updatePlayhead() {
            if (!daw) return;
            
            const playhead = document.getElementById('playhead');
            const timeline = document.getElementById('timeline');
            const beatsPerMinute = daw.tempo;
            const secondsPerBeat = 60 / beatsPerMinute;
            const beatsPerMeasure = daw.timeSignature[0];
            const secondsPerMeasure = secondsPerBeat * beatsPerMeasure;
            
            const currentMeasure = daw.currentTime / secondsPerMeasure;
            const pixelsPerMeasure = 100; // Matches CSS grid
            
            playhead.style.left = `${currentMeasure * pixelsPerMeasure}px`;
        }

        function updateMeters() {
            // Update all level meters with random values for demo
            document.querySelectorAll('.level-fill').forEach(meter => {
                const level = Math.random() * 100;
                meter.style.height = `${level}%`;
            });
            
            // Update CPU meter
            const cpuFill = document.getElementById('cpuFill');
            const cpuValue = document.getElementById('cpuValue');
            if (cpuFill && cpuValue) {
                const cpu = 30 + Math.random() * 20;
                cpuFill.style.width = `${cpu}%`;
                cpuValue.textContent = `${Math.round(cpu)}%`;
            }
        }

        // UI Generation Functions
        function generateSampleLibrary() {
            const sampleGrid = document.getElementById('sampleGrid');
            const samples = [
                { name: 'Acoustic Kick', type: 'Drum', length: '0.5s', bpm: '120' },
                { name: 'Snare Rim', type: 'Drum', length: '0.3s', bpm: '120' },
                { name: 'Open Hi-Hat', type: 'Drum', length: '1.2s', bpm: '120' },
                { name: 'Bass Drop', type: 'Bass', length: '2.1s', bpm: '128' },
                { name: 'Piano Chord', type: 'Piano', length: '3.4s', bpm: '110' },
                { name: 'String Pad', type: 'Strings', length: '8.0s', bpm: '90' },
                { name: 'Lead Riff', type: 'Synth', length: '4.2s', bpm: '130' },
                { name: 'Vocal Chop', type: 'Vocal', length: '1.8s', bpm: '120' }
            ];
            
            sampleGrid.innerHTML = samples.map(sample => `
                <div class="sample-item" onclick="playSample('${sample.name}')">
                    <div class="sample-waveform"></div>
                    <div class="sample-info">
                        <div class="sample-name">${sample.name}</div>
                        <div class="sample-details">${sample.type} • ${sample.length} • ${sample.bpm} BPM</div>
                    </div>
                </div>
            `).join('');
        }

        function generateTimeMarkers() {
            const timeMarkers = document.getElementById('timeMarkers');
            const markers = [];
            
            for (let i = 0; i <= 32; i++) {
                const measure = Math.floor(i / 4) + 1;
                const beat = (i % 4) + 1;
                markers.push(`<div class="time-marker">${measure}.${beat}</div>`);
            }
            
            timeMarkers.innerHTML = markers.join('');
        }

        function createDemoClips() {
            const trackContent = document.getElementById('trackContent');
            const clips = [
                { track: 0, start: 0, length: 400, name: 'Kick Pattern' },
                { track: 1, start: 100, length: 300, name: 'Snare Roll' },
                { track: 2, start: 0, length: 800, name: 'Hi-Hat Loop' },
                { track: 3, start: 200, length: 600, name: 'Bass Line' },
                { track: 4, start: 400, length: 800, name: 'Piano Chords' },
                { track: 5, start: 600, length: 400, name: 'String Pad' },
                { track: 6, start: 800, length: 300, name: 'Lead Melody' },
                { track: 7, start: 1000, length: 200, name: 'Vocal Sample' }
            ];
            
            clips.forEach(clip => {
                const clipElement = document.createElement('div');
                clipElement.className = 'audio-clip';
                clipElement.style.left = `${clip.start}px`;
                clipElement.style.width = `${clip.length}px`;
                clipElement.style.top = `${clip.track * 81 + 10}px`;
                
                clipElement.innerHTML = `
                    <div class="clip-header">${clip.name}</div>
                    <div class="clip-waveform">
                        <canvas class="waveform-canvas" width="${clip.length}" height="40"></canvas>
                    </div>
                    <div class="clip-fade-in"></div>
                    <div class="clip-fade-out"></div>
                `;
                
                clipElement.onclick = () => selectClip(clipElement);
                
                trackContent.appendChild(clipElement);
                
                // Generate waveform for clip
                setTimeout(() => generateClipWaveform(clipElement.querySelector('canvas'), clip.track), 50);
            });
        }

            renderTracks() {
                const trackHeaders = document.getElementById('trackHeaders');
                const trackContent = document.getElementById('trackContent');
                
                trackHeaders.innerHTML = '';
                
                this.tracks.forEach((track, index) => {
                    const header = document.createElement('div');
                    header.className = 'track-header';
                    
                    header.innerHTML = `
                        <div class="track-info">
                            <input type="text" class="track-name" value="${track.name}" onchange="renameTrack(${index}, this.value)">
                            <span class="track-type">${track.type.toUpperCase()}</span>
                        </div>
                        <div class="track-controls">
                            <button class="track-btn mute-btn ${track.muted ? 'active' : ''}" onclick="toggleTrackMute(${index})">M</button>
                            <button class="track-btn solo-btn ${track.solo ? 'active' : ''}" onclick="toggleTrackSolo(${index})">S</button>
                            <button class="track-btn record-btn ${track.recording ? 'active' : ''}" onclick="toggleTrackRecord(${index})">R</button>
                            <button class="track-btn monitor-btn ${track.monitoring ? 'active' : ''}" onclick="toggleTrackMonitor(${index})">I</button>
                            <div class="track-meters">
                                <div class="level-meter">
                                    <div class="level-fill" style="height: ${Math.random() * 80 + 10}%"></div>
                                </div>
                                <div class="level-meter">
                                    <div class="level-fill" style="height: ${Math.random() * 80 + 10}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    header.style.backgroundColor = track.color + '20';
                    header.style.borderLeft = `3px solid ${track.color}`;
                    
                    trackHeaders.appendChild(header);
                });
            }

            createMixerChannel(track, index) {
                const channel = document.createElement('div');
                channel.className = 'mixer-channel';
                
                channel.innerHTML = `
                    <div class="channel-header">
                        <div class="channel-name">${track.name}</div>
                        <div class="channel-type">${track.type}</div>
                    </div>
                    
                    <div class="eq-section">
                        <div class="eq-curve"></div>
                    </div>
                    
                    <div class="eq-knobs">
                        <div class="eq-knob">
                            <div class="knob" data-param="high" data-track="${index}"></div>
                            <div class="knob-label">HIGH</div>
                        </div>
                        <div class="eq-knob">
                            <div class="knob" data-param="mid" data-track="${index}"></div>
                            <div class="knob-label">MID</div>
                        </div>
                        <div class="eq-knob">
                            <div class="knob" data-param="low" data-track="${index}"></div>
                            <div class="knob-label">LOW</div>
                        </div>
                    </div>
                    
                    <div class="sends-section">
                        <div class="sends-header">SENDS</div>
                        <div class="send-knobs">
                            <div class="eq-knob">
                                <div class="knob" data-param="send1" data-track="${index}"></div>
                                <div class="knob-label">1</div>
                            </div>
                            <div class="eq-knob">
                                <div class="knob" data-param="send2" data-track="${index}"></div>
                                <div class="knob-label">2</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fader-section">
                        <div class="eq-knob pan-knob">
                            <div class="knob" data-param="pan" data-track="${index}"></div>
                            <div class="knob-label">PAN</div>
                        </div>
                        
                        <div class="channel-meters">
                            <div class="level-meter">
                                <div class="level-fill" style="height: ${Math.random() * 80 + 20}%"></div>
                            </div>
                            <div class="level-meter">
                                <div class="level-fill" style="height: ${Math.random() * 80 + 20}%"></div>
                            </div>
                        </div>
                        
                        <div class="volume-fader" data-track="${index}" onclick="adjustFader(event, ${index})">
                            <div class="fader-handle" style="top: ${(1 - track.volume) * 100}%"></div>
                        </div>
                        
                        <div class="volume-label">${Math.round(track.volume * 100)}</div>
                    </div>
                `;
                
                return channel;
            }

            createMasterChannel() {
                const channel = document.createElement('div');
                channel.className = 'mixer-channel master-channel';
                
                channel.innerHTML = `
                    <div class="channel-header">
                        <div class="channel-name">MASTER</div>
                        <div class="channel-type">OUT</div>
                    </div>
                    
                    <div class="eq-section">
                        <div class="eq-curve"></div>
                    </div>
                    
                    <div class="eq-knobs">
                        <div class="eq-knob">
                            <div class="knob" data-param="master-high"></div>
                            <div class="knob-label">HIGH</div>
                        </div>
                        <div class="eq-knob">
                            <div class="knob" data-param="master-mid"></div>
                            <div class="knob-label">MID</div>
                        </div>
                        <div class="eq-knob">
                            <div class="knob" data-param="master-low"></div>
                            <div class="knob-label">LOW</div>
                        </div>
                    </div>
                    
                    <div class="fader-section">
                        <div class="channel-meters">
                            <div class="level-meter">
                                <div class="level-fill" style="height: 85%"></div>
                            </div>
                            <div class="level-meter">
                                <div class="level-fill" style="height: 80%"></div>
                            </div>
                        </div>
                        
                        <div class="volume-fader" onclick="adjustMasterFader(event)">
                            <div class="fader-handle" style="top: 25%"></div>
                        </div>
                        
                        <div class="volume-label">75</div>
                    </div>
                `;
                
                return channel;
            }

            startVisualization() {
                // Create advanced spectrum analyzer
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 100;
                canvas.style.position = 'fixed';
                canvas.style.bottom = '20px';
                canvas.style.left = '20px';
                canvas.style.background = 'rgba(0, 0, 0, 0.8)';
                canvas.style.borderRadius = '8px';
                canvas.style.border = '1px solid #333';
                document.body.appendChild(canvas);
                
                const ctx = canvas.getContext('2d');
                
                function drawSpectrum() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Create realistic spectrum visualization
                    const barCount = 64;
                    const barWidth = canvas.width / barCount;
                    
                    for (let i = 0; i < barCount; i++) {
                        const barHeight = Math.random() * canvas.height * 0.8;
                        const hue = (i / barCount) * 240; // Blue to red spectrum
                        
                        const gradient = ctx.createLinearGradient(0, canvas.height, 0, canvas.height - barHeight);
                        gradient.addColorStop(0, `hsl(${hue}, 70%, 50%)`);
                        gradient.addColorStop(1, `hsl(${hue}, 70%, 70%)`);
                        
                        ctx.fillStyle = gradient;
                        ctx.fillRect(i * barWidth, canvas.height - barHeight, barWidth - 1, barHeight);
                    }
                    
                    requestAnimationFrame(drawSpectrum);
                }
                
                drawSpectrum();
            }

        function generateClipWaveform(canvas, trackType) {
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            // Generate waveform based on track type
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, '#4ecdc4');
            gradient.addColorStop(0.5, '#45b7d1');
            gradient.addColorStop(1, '#36a2eb');
            
            ctx.fillStyle = gradient;
            ctx.strokeStyle = '#4ecdc4';
            ctx.lineWidth = 1;
            
            ctx.beginPath();
            for (let x = 0; x < width; x += 2) {
                let amplitude;
                
                switch(trackType) {
                    case 0: // Drums - sharp peaks
                        amplitude = Math.random() > 0.8 ? Math.random() * 0.9 : Math.random() * 0.1;
                        break;
                    case 3: // Bass - low frequency waves  
                        amplitude = Math.sin(x * 0.05) * 0.7 + Math.random() * 0.1;
                        break;
                    case 4: // Piano - varied peaks with decay
                        amplitude = Math.random() > 0.7 ? Math.random() * 0.8 : Math.sin(x * 0.02) * 0.4;
                        break;
                    case 6: // Lead - sustained waves
                        amplitude = Math.sin(x * 0.08) * 0.6 + Math.sin(x * 0.02) * 0.2;
                        break;
                    default:
                        amplitude = Math.random() * 0.5;
                }
                
                const y = height / 2 + amplitude * height * 0.4 * (Math.random() > 0.5 ? 1 : -1);
                
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // Add waveform fill
            ctx.globalAlpha = 0.3;
            ctx.fill();
            ctx.globalAlpha = 1.0;
        }

        // Track Control Functions
        function toggleTrackMute(trackIndex) {
            if (!daw || !daw.tracks) {
                console.warn('DAW not initialized');
                return;
            }
            
            try {
                const track = daw.tracks.get(trackIndex);
                if (track) {
                    track.setMute(!track.muted);
                    daw.renderTracks();
                    updateMixerChannel(trackIndex);
                }
            } catch (error) {
                console.error('Error toggling track mute:', error);
            }
        }

        function toggleTrackSolo(trackIndex) {
            if (!daw || !daw.tracks) {
                console.warn('DAW not initialized');
                return;
            }
            
            try {
                const track = daw.tracks.get(trackIndex);
                if (track) {
                    track.setSolo(!track.solo);
                    
                    // Handle solo logic for all tracks
                    const hasSolo = Array.from(daw.tracks.values()).some(t => t.solo);
                    daw.tracks.forEach((t, idx) => {
                        if (hasSolo) {
                            if (t.outputNode && t.outputNode.gain) {
                                t.outputNode.gain.value = t.solo ? t.volume : 0;
                            }
                        } else {
                            if (t.outputNode && t.outputNode.gain) {
                                t.outputNode.gain.value = t.muted ? 0 : t.volume;
                            }
                        }
                    });
                    
                    daw.renderTracks();
                }
            } catch (error) {
                console.error('Error toggling track solo:', error);
            }
        }

        function toggleTrackRecord(trackIndex) {
            if (!daw || !daw.tracks) {
                console.warn('DAW not initialized');
                return;
            }
            
            try {
                const track = daw.tracks.get(trackIndex);
                if (track) {
                    track.recording = !track.recording;
                    daw.renderTracks();
                    
                    if (track.recording) {
                        console.log(`Recording enabled on track: ${track.name}`);
                        // Enable input monitoring and recording
                        startTrackRecording(trackIndex);
                    } else {
                        console.log(`Recording disabled on track: ${track.name}`);
                        stopTrackRecording(trackIndex);
                    }
                }
            } catch (error) {
                console.error('Error toggling track record:', error);
            }
        }

        function toggleTrackMonitor(trackIndex) {
            if (!daw || !daw.tracks) {
                console.warn('DAW not initialized');
                return;
            }
            
            try {
                const track = daw.tracks.get(trackIndex);
                if (track) {
                    track.monitoring = !track.monitoring;
                    daw.renderTracks();
                    
                    if (track.monitoring) {
                        console.log(`Input monitoring enabled on track: ${track.name}`);
                    } else {
                        console.log(`Input monitoring disabled on track: ${track.name}`);
                    }
                }
            } catch (error) {
                console.error('Error toggling track monitor:', error);
            }
        }

        function renameTrack(trackIndex, newName) {
            if (!daw || !daw.tracks) return;
            
            try {
                const track = daw.tracks.get(trackIndex);
                if (track) {
                    track.name = newName;
                    updateMixerChannel(trackIndex);
                }
            } catch (error) {
                console.error('Error renaming track:', error);
            }
        }

        function startTrackRecording(trackIndex) {
            // Implement audio input recording for the specific track
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    const track = daw.tracks.get(trackIndex);
                    const mediaRecorder = new MediaRecorder(stream);
                    const audioChunks = [];
                    
                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        // Process and add recorded audio as a clip
                        console.log('Recording completed, processing audio...');
                    };
                    
                    mediaRecorder.start();
                    track.mediaRecorder = mediaRecorder;
                })
                .catch(err => {
                    console.error('Could not access microphone:', err);
                });
        }

        function stopTrackRecording(trackIndex) {
            const track = daw.tracks.get(trackIndex);
            if (track && track.mediaRecorder) {
                track.mediaRecorder.stop();
                track.mediaRecorder = null;
            }
        }

        // Mixer Functions
        function adjustFader(event, trackIndex) {
            const fader = event.currentTarget;
            const rect = fader.getBoundingClientRect();
            const y = event.clientY - rect.top;
            const value = 1 - (y / rect.height);
            const clampedValue = Math.max(0, Math.min(1, value));
            
            const track = daw.tracks.get(trackIndex);
            if (track) {
                track.setVolume(clampedValue);
                
                // Update fader handle position
                const handle = fader.querySelector('.fader-handle');
                handle.style.top = `${(1 - clampedValue) * 100}%`;
                
                // Update volume label
                const label = fader.parentElement.querySelector('.volume-label');
                label.textContent = Math.round(clampedValue * 100);
            }
        }

        function adjustMasterFader(event) {
            const fader = event.currentTarget;
            const rect = fader.getBoundingClientRect();
            const y = event.clientY - rect.top;
            const value = 1 - (y / rect.height);
            const clampedValue = Math.max(0, Math.min(1, value));
            
            if (daw && daw.masterGain) {
                daw.masterGain.gain.value = clampedValue;
                
                // Update fader handle position
                const handle = fader.querySelector('.fader-handle');
                handle.style.top = `${(1 - clampedValue) * 100}%`;
                
                // Update volume label
                const label = fader.parentElement.querySelector('.volume-label');
                label.textContent = Math.round(clampedValue * 100);
            }
        }

        function updateMixerChannel(trackIndex) {
            // Update the mixer channel display
            const track = daw.tracks.get(trackIndex);
            if (track) {
                const channelName = document.querySelector(`[data-track="${trackIndex}"] .channel-name`);
                if (channelName) {
                    channelName.textContent = track.name;
                }
            }
        }

        // Piano Roll Functions
        function initializePianoRoll() {
            const pianoKeys = document.getElementById('pianoKeys');
            const pianoGrid = document.getElementById('pianoGrid');
            
            // Generate piano keys (88 keys, but show middle range)
            pianoKeys.innerHTML = '';
            pianoGrid.innerHTML = '';
            
            const startNote = 36; // C2
            const endNote = 96;   // C7
            const keyHeight = 12;
            
            for (let note = endNote; note >= startNote; note--) {
                const isBlackKey = [1, 3, 6, 8, 10].includes(note % 12);
                const noteName = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'][note % 12];
                const octave = Math.floor(note / 12) - 1;
                
                const key = document.createElement('div');
                key.className = `piano-key ${isBlackKey ? 'black-key' : 'white-key'}`;
                key.style.height = `${keyHeight}px`;
                key.style.backgroundColor = isBlackKey ? '#333' : '#fff';
                key.style.color = isBlackKey ? '#fff' : '#000';
                key.style.border = '1px solid #555';
                key.style.display = 'flex';
                key.style.alignItems = 'center';
                key.style.paddingLeft = '8px';
                key.style.fontSize = '9px';
                key.style.cursor = 'pointer';
                key.textContent = `${noteName}${octave}`;
                
                key.onclick = () => playPianoNote(note);
                pianoKeys.appendChild(key);
                
                // Add grid line for this note
                const gridLine = document.createElement('div');
                gridLine.style.height = `${keyHeight}px`;
                gridLine.style.borderBottom = '1px solid #333';
                gridLine.style.backgroundColor = isBlackKey ? 'rgba(0,0,0,0.1)' : 'rgba(0,0,0,0.05)';
                gridLine.style.position = 'relative';
                
                pianoGrid.appendChild(gridLine);
            }
            
            // Add time grid
            const timeGrid = document.createElement('div');
            timeGrid.style.position = 'absolute';
            timeGrid.style.top = '0';
            timeGrid.style.left = '0';
            timeGrid.style.right = '0';
            timeGrid.style.height = '100%';
            timeGrid.style.backgroundImage = 'repeating-linear-gradient(90deg, transparent, transparent 99px, #333 100px)';
            timeGrid.style.pointerEvents = 'none';
            pianoGrid.appendChild(timeGrid);
        }

        function playPianoNote(note) {
            if (daw && daw.instruments.has('piano')) {
                const piano = daw.instruments.get('piano');
                piano.play(note, 100);
            }
        }

        function closePianoRoll() {
            document.getElementById('pianoRoll').classList.remove('active');
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.view-btn[onclick="switchView(\'arrangement\')"]').classList.add('active');
        }

        // Clip Management
        function selectClip(clipElement) {
            document.querySelectorAll('.audio-clip').forEach(clip => clip.classList.remove('selected'));
            clipElement.classList.add('selected');
            
            // Update inspector with clip properties
            updateInspectorForClip(clipElement);
        }

        function updateInspectorForClip(clipElement) {
            const clipName = clipElement.querySelector('.clip-header').textContent;
            const inspector = document.querySelector('.inspector-section');
            
            // Update inspector fields
            const nameInput = inspector.querySelector('input[value="Audio Clip 1"]');
            if (nameInput) nameInput.value = clipName;
        }

        function playSample(sampleName) {
            console.log(`Playing sample: ${sampleName}`);
            
            // Visual feedback
            event.target.style.backgroundColor = '#2a2a2a';
            setTimeout(() => {
                event.target.style.backgroundColor = '';
            }, 200);
            
            // In a real implementation, you'd load and play the actual sample
            if (daw) {
                // Simulate sample playback
                const sampleTypes = {
                    'Acoustic Kick': 'kick',
                    'Snare Rim': 'snare',
                    'Open Hi-Hat': 'hihat'
                };
                
                const drumType = sampleTypes[sampleName];
                if (drumType && daw.instruments.has('drum-kit')) {
                    const drums = daw.instruments.get('drum-kit');
                    drums.play(drumType);
                }
            }
        }

        // Collaboration Functions
        function showCollaboration() {
            const overlay = document.getElementById('collaborationOverlay');
            overlay.style.display = 'block';
            
            // Populate collaborators
            const collaborators = [
                { name: 'Alex Chen', avatar: 'A', activity: 'Editing Track 2', online: true },
                { name: 'Maria Lopez', avatar: 'M', activity: 'Recording Bass', online: true },
                { name: 'Jordan Kim', avatar: 'J', activity: 'Mixing', online: true },
                { name: 'Sam Wilson', avatar: 'S', activity: 'Away', online: false }
            ];
            
            const collaboratorList = document.getElementById('collaboratorList');
            collaboratorList.innerHTML = collaborators.map(collab => `
                <div class="collaborator">
                    <div class="avatar" style="background: ${collab.online ? 'linear-gradient(45deg, #ff6b35, #4ecdc4)' : '#666'}">${collab.avatar}</div>
                    <div class="collaborator-info">
                        <div class="collaborator-name">${collab.name}</div>
                        <div class="collaborator-activity">${collab.activity}</div>
                    </div>
                    <div class="presence-indicator" style="background: ${collab.online ? '#2ed573' : '#ff4757'}"></div>
                </div>
            `).join('');
        }

        function hideCollaboration() {
            document.getElementById('collaborationOverlay').style.display = 'none';
        }

        function exportProject() {
            console.log('Exporting project...');
            
            // Show export dialog simulation
            const formats = ['WAV (24-bit)', 'MP3 (320kbps)', 'FLAC', 'Project File (.bfp)'];
            const selectedFormat = prompt(`Export format:\n${formats.map((f, i) => `${i + 1}. ${f}`).join('\n')}\n\nEnter number (1-4):`, '1');
            
            if (selectedFormat) {
                const format = formats[parseInt(selectedFormat) - 1] || formats[0];
                console.log(`Exporting as: ${format}`);
                
                // Simulate export process
                const progress = document.createElement('div');
                progress.style.position = 'fixed';
                progress.style.top = '50%';
                progress.style.left = '50%';
                progress.style.transform = 'translate(-50%, -50%)';
                progress.style.background = 'rgba(26, 26, 26, 0.95)';
                progress.style.padding = '20px';
                progress.style.borderRadius = '8px';
                progress.style.border = '1px solid #333';
                progress.style.color = '#fff';
                progress.style.textAlign = 'center';
                progress.style.zIndex = '2000';
                progress.innerHTML = `
                    <div>Exporting: ${format}</div>
                    <div style="margin: 10px 0;">
                        <div style="width: 200px; height: 4px; background: #333; border-radius: 2px; overflow: hidden;">
                            <div id="exportProgress" style="height: 100%; background: linear-gradient(90deg, #4ecdc4, #45b7d1); width: 0%; transition: width 0.3s;"></div>
                        </div>
                    </div>
                    <div id="exportStatus">Processing tracks...</div>
                `;
                
                document.body.appendChild(progress);
                
                // Simulate export progress
                let progressValue = 0;
                const progressBar = document.getElementById('exportProgress');
                const status = document.getElementById('exportStatus');
                
                const progressInterval = setInterval(() => {
                    progressValue += Math.random() * 15 + 5;
                    progressBar.style.width = `${Math.min(progressValue, 100)}%`;
                    
                    if (progressValue >= 100) {
                        status.textContent = 'Export complete!';
                        clearInterval(progressInterval);
                        setTimeout(() => {
                            document.body.removeChild(progress);
                        }, 1500);
                    } else if (progressValue > 75) {
                        status.textContent = 'Finalizing...';
                    } else if (progressValue > 50) {
                        status.textContent = 'Rendering effects...';
                    } else if (progressValue > 25) {
                        status.textContent = 'Mixing tracks...';
                    }
                }, 200);
            }
        }

        // Advanced Features
        function adjustZoom(event) {
            const slider = event.currentTarget;
            const rect = slider.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const percentage = x / rect.width;
            
            daw.zoomLevel = Math.max(0.1, Math.min(5.0, percentage * 5));
            
            // Update zoom handle position
            const handle = document.getElementById('zoomHandle');
            handle.style.left = `${percentage * 100}%`;
            
            // Apply zoom to timeline and tracks
            applyZoom(daw.zoomLevel);
            
            console.log(`Zoom level: ${Math.round(daw.zoomLevel * 100)}%`);
        }

        function applyZoom(zoomLevel) {
            const timeline = document.getElementById('timeline');
            const trackContent = document.getElementById('trackContent');
            
            const baseWidth = 2000;
            const newWidth = baseWidth * zoomLevel;
            
            timeline.style.minWidth = `${newWidth}px`;
            trackContent.style.minWidth = `${newWidth}px`;
            
            // Update background grid
            const gridSpacing = 100 * zoomLevel;
            timeline.style.backgroundImage = `repeating-linear-gradient(90deg, transparent, transparent ${gridSpacing - 1}px, #333 ${gridSpacing}px)`;
            trackContent.style.backgroundImage = `repeating-linear-gradient(90deg, transparent, transparent ${gridSpacing - 1}px, #333 ${gridSpacing}px)`;
        }

        function zoomToFit() {
            // Calculate optimal zoom to fit all content
            daw.zoomLevel = 1.0;
            applyZoom(daw.zoomLevel);
            
            const handle = document.getElementById('zoomHandle');
            handle.style.left = '20%';
        }

        // Tempo and Time Signature Controls
        function updateTempo() {
            const tempoInput = document.getElementById('tempoInput');
            daw.tempo = parseInt(tempoInput.value);
            console.log(`Tempo changed to ${daw.tempo} BPM`);
            
            // Update metronome and timeline if playing
            if (daw.isPlaying) {
                // Recalculate playback timing
            }
        }

        function updateTimeSignature() {
            const timeSigInput = document.getElementById('timeSigInput');
            const parts = timeSigInput.value.split('/');
            if (parts.length === 2) {
                daw.timeSignature = [parseInt(parts[0]), parseInt(parts[1])];
                console.log(`Time signature changed to ${daw.timeSignature.join('/')}`);
                
                // Update timeline markers
                generateTimeMarkers();
            }
        }

        // Automation and Modulation
        function enableAutomation(parameter, trackIndex) {
            console.log(`Enabling automation for ${parameter} on track ${trackIndex}`);
            // In a real DAW, this would create automation lanes
        }

        // Real-time Collaboration Simulation
        function simulateRealTimeCollaboration() {
            setInterval(() => {
                // Simulate cursor movements
                const cursors = ['alex-cursor', 'maria-cursor', 'jordan-cursor'];
                cursors.forEach(cursorId => {
                    let cursor = document.getElementById(cursorId);
                    if (!cursor) {
                        cursor = document.createElement('div');
                        cursor.id = cursorId;
                        cursor.style.position = 'absolute';
                        cursor.style.width = '2px';
                        cursor.style.height = '100px';
                        cursor.style.background = `hsl(${Math.random() * 360}, 70%, 60%)`;
                        cursor.style.zIndex = '50';
                        cursor.style.pointerEvents = 'none';
                        cursor.style.opacity = '0.7';
                        document.getElementById('trackContent').appendChild(cursor);
                    }
                    
                    // Random cursor movement
                    cursor.style.left = `${Math.random() * 1800 + 100}px`;
                    cursor.style.top = `${Math.random() * 500 + 50}px`;
                });
                
                // Simulate collaborative edits
                if (Math.random() > 0.9) {
                    console.log('Collaborative edit detected - syncing changes...');
                }
            }, 2000);
        }

        // Initialize when page loads
        window.addEventListener('load', async () => {
            try {
                await initializeDAW();
                
                // Add event listeners for tempo and time signature
                document.getElementById('tempoInput').addEventListener('change', updateTempo);
                document.getElementById('timeSigInput').addEventListener('change', updateTimeSignature);
                
                // Start real-time collaboration simulation
                simulateRealTimeCollaboration();
                
                // Add keyboard shortcuts for professional workflow
                document.addEventListener('keydown', (event) => {
                    if (event.target.tagName !== 'INPUT') {
                        switch(event.key) {
                            case ' ': // Spacebar - Play/Pause
                                event.preventDefault();
                                togglePlay();
                                break;
                            case 'r': // R - Record
                                if (event.ctrlKey || event.metaKey) {
                                    event.preventDefault();
                                    toggleRecord();
                                }
                                break;
                            case 's': // S - Save (Ctrl+S)
                                if (event.ctrlKey || event.metaKey) {
                                    event.preventDefault();
                                    console.log('Project saved');
                                }
                                break;
                            case 'z': // Z - Undo (Ctrl+Z)
                                if (event.ctrlKey || event.metaKey) {
                                    event.preventDefault();
                                    console.log('Undo last action');
                                }
                                break;
                            case 'y': // Y - Redo (Ctrl+Y)
                                if (event.ctrlKey || event.metaKey) {
                                    event.preventDefault();
                                    console.log('Redo last action');
                                }
                                break;
                            case '1':
                            case '2':
                            case '3':
                            case '4':
                            case '5':
                            case '6':
                            case '7':
                            case '8':
                                // Quick track selection
                                if (!event.ctrlKey && !event.metaKey) {
                                    const trackNum = parseInt(event.key) - 1;
                                    console.log(`Selected track ${trackNum + 1}`);
                                }
                                break;
                        }
                    }
                });
                
                console.log('🎵 BeatForge Pro Studio is ready for professional music production!');
                console.log('Features: Multi-track recording, Real-time collaboration, Professional effects, Virtual instruments');
                console.log('Shortcuts: Space (play/pause), Ctrl+R (record), Ctrl+S (save), Ctrl+Z (undo)');
            } catch (error) {
                console.error('Failed to initialize professional DAW:', error);
            }
        });
    </script>
</body>
</html>
